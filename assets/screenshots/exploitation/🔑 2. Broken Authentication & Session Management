```markdown
# Broken Authentication and Session Management

**Category overview**  
Broken Authentication and Session Management covers flaws where an application fails to properly verify user identity or protect authentication and session mechanisms. Typical issues include weak password policies, insecure password reset flows, missing server-side checks when changing credentials, session fixation or weak session IDs, and trusting client-supplied role/privilege values. Exploitation can lead to account takeover, privilege escalation, and impersonation.

---

## Overview Observed in This Assessment

In this capstone assessment the following broken-authentication issues were observed and exploited in a controlled lab environment:

- **Change Bender’s Password** — password change endpoint accepted a tampered request without verifying the current password.  
- **Reset Jim’s Password** — password reset flow relied on a brute-forceable security question.  
- **Login Amy** — account takeover using OSINT-driven password derivation and automated guessing.  
- **Admin Registration** — client-supplied role in registration JSON could be manipulated to create an administrative account.

Each finding below contains a concise Steps to Reproduce, Impact, and Mitigations.

---

### A Change Bender’s Password

**What it is**  
A password-change endpoint that accepts a request to set a new password without verifying the existing password or re-authenticating the user.

**Observed in lab**  
After authentication (or using SQLi to authenticate), the change-password request was intercepted and modified in Burp. The `currentPassword` field was removed or blanked and `newPassword` set to a known value. The server accepted the change and updated the account password.

**Steps to Reproduce (concise)**  
1. Authenticate as target account (or obtain access via prior exploit).  
2. Intercept Change Password POST in Burp Proxy.  
3. Remove or blank the `currentPassword` field and set `newPassword` to the desired value.  
4. Forward the request and log in using the new password.

**Impact**  
- Immediate account takeover without knowing the original password.  
- Unauthorized access to user data and actions.  
- If admin affected, full platform compromise.

**Mitigations**  
- Require server-side verification of the current password before allowing changes.  
- Require re-authentication or a time-limited session assertion for sensitive operations.  
- Log and alert on password-change requests that omit or fail current-password verification.  
- Enforce strong password rules and rate-limit change attempts.

---

### B Reset Jim’s Password

**What it is**  
An account recovery flow that relies on easily guessable or brute-forcible knowledge-based questions without rate-limiting or additional verification.

**Observed in lab**  
The Forgot Password flow accepted answers to a security question. A wordlist + Turbo Intruder style attack brute-forced the correct answer, allowing the attacker to set a new password.

**Steps to Reproduce (concise)**  
1. Visit Forgot Password and enter target email `jim@juice-sh.op`.  
2. Intercept the answer submission request and send to Intruder/Turbo Intruder.  
3. Run a wordlist of likely answers until success.  
4. Complete reset and set a new password.

**Impact**  
- Complete account takeover for targeted account.  
- Scalable risk if many accounts share weak or guessable security answers.

**Mitigations**  
- Use time-limited, single-use reset tokens sent to verified email or phone.  
- Implement rate-limiting, progressive delays, and account lockout for repeated failures.  
- Prefer token-based recovery over knowledge-based questions; if used, choose non-public, high-entropy questions.  
- Require MFA for sensitive accounts and recovery flows.

---

### C Login Amy

**What it is**  
Credential compromise using OSINT and predictable password patterns combined with automated guessing against an unprotected auth endpoint.

**Observed in lab**  
Hints and public information were used to construct candidate passwords. Turbo Intruder enumerated permutations and found the correct password for `amy@juice-sh.op`.

**Steps to Reproduce (concise)**  
1. Gather OSINT and challenge hints relevant to the target.  
2. Generate candidate password permutations (case, digits, padding).  
3. Intercept login POST and run automated guessing until authentication succeeds.

**Impact**  
- Account takeover and access to linked sensitive information.  
- Potential lateral compromise if users reuse passwords.

**Mitigations**  
- Enforce strong password complexity and block common patterns.  
- Harden auth endpoints with rate-limiting, account lockout, and CAPTCHA on suspicious attempts.  
- Require MFA for sensitive accounts.  
- Avoid publishing password hints and educate users about password hygiene.

---

### D Admin Registration

**What it is**  
Relying on client-supplied role/privilege attributes at registration, allowing attackers to request elevated roles when creating accounts.

**Observed in lab**  
The registration JSON accepted a `role` or `isAdmin` parameter. By intercepting and changing `"role":"customer"` to `"role":"admin"` the attacker created an account with administrative privileges.

**Steps to Reproduce (concise)**  
1. Start a normal registration flow and capture the POST in Burp.  
2. Modify the JSON body to set `"role":"admin"`.  
3. Forward the request and verify admin capabilities.

**Impact**  
- Unauthorized privilege escalation and creation of admin accounts.  
- Potential full system compromise if admin functionality is unrestricted.

**Mitigations**  
- Assign roles server-side only; never trust client-supplied role attributes.  
- Remove role parameters from client payloads.  
- Enforce server-side authorization checks for privileged endpoints.  
- Log and review privileged account creation and require manual approvals for admin roles.

---

## Detection and Logging Recommendations

- Log all authentication events (success and failure) with context (IP, user-agent, timestamp).  
- Alert on unusual patterns: missing `currentPassword` fields, repeated reset attempts, multiple failed logins from same IP.  
- Monitor and alert on creation of privileged accounts and anomalous role assignments.  
- Retain rate-limited audit logs for forensic analysis.

---

## Hardening Checklist

- Enforce server-side checks for all authentication and account-management operations.  
- Replace knowledge-based recovery with email/SMS token flows and require re-authentication for sensitive actions.  
- Add rate-limiting, CAPTCHA, and progressive lockout on authentication endpoints.  
- Use strong password hashing (bcrypt or Argon2) and enable MFA.  
- Remove client-controllable privilege parameters; role assignment must be server-driven.  
- Include auth flow tests in SAST/DAST and CI pipelines and perform regular manual auth testing.

---
```
