```markdown
# Broken Access Control

**Category overview**  
Broken Access Control occurs when an application does not correctly enforce who can perform which actions or access which resources. Failures include missing server-side authorization checks, predictable object identifiers (IDOR), forced browsing to hidden endpoints, directory traversal, and unsafe direct access to backups or internal files. Exploitation can allow attackers to view or modify other users’ data, perform actions as privileged users, or access sensitive system artifacts.

---

## Overview Observed in This Assessment

The following access-control issues were identified and exploited in a controlled Juice Shop lab:

- **Forged Feedback** — attacker manipulated the UserId in feedback submissions to act as another user.  
- **Forged Review** — review creation accepted arbitrary user identifiers, enabling impersonation.  
- **Forgotten Sales Backup** — backup files under `/ftp` were accessible without authorization.  
- **Misplaced Signature File** — internal YAML configuration exposed via an unprotected endpoint.  
- **Deprecated Interface** — legacy XML endpoint accepted modified uploads that bypassed modern checks.

Each finding below contains concise Steps to Reproduce, Impact, and Mitigations.

---

### A Forged Feedback (UserId Manipulation)

**What it is**  
Client-controllable identifiers (e.g., userId) are trusted by the server, allowing a user to submit or modify data on behalf of another user.

**Observed in lab**  
Feedback POSTs included a `UserId` field. Intercepting and replacing this value with another user’s ID caused the feedback to be recorded as coming from that user.

**Steps to Reproduce (concise)**  
1. Submit feedback as your account and intercept the POST in Burp.  
2. Modify the `UserId` field to another user’s numeric/UUID value.  
3. Forward the request and verify the feedback appears under the target user.

**Impact**  
- Impersonation and fraudulent content attribution.  
- Reputation damage and potential abuse of user-specific features.  
- If tied to privileges, could enable lateral privilege abuse.

**Mitigations**  
- Ignore client-supplied user identifiers; derive user identity from the authenticated session server-side.  
- Validate and authorize every action against the session user on the server.  
- Log attempts to perform actions on behalf of other users and alert on anomalies.

---

### B Forged Review (Impersonated Review Submission)

**What it is**  
The application accepts client-specified author identifiers during review creation, allowing one user to create or delete content as another.

**Observed in lab**  
Review creation accepted a `authorId` parameter. Changing this parameter in transit allowed creating reviews attributed to other users and deleting their reviews where endpoints permitted.

**Steps to Reproduce (concise)**  
1. Create or edit a review while intercepting the request.  
2. Replace `authorId` with the target user’s ID.  
3. Submit and confirm the review shows under that user’s account.

**Impact**  
- Fraudulent reviews or content planted under innocent users.  
- Abuse where actions trigger downstream privileges or notifications.  
- Difficulty tracing true actors for forensics.

**Mitigations**  
- Bind created content to the authenticated user server-side; ignore client-provided author fields.  
- Enforce server-side authorization on create/update/delete operations for content.  
- Rate-limit or require additional verification for sensitive content changes.

---

### C Forgotten Sales Backup (Unprotected Backup Files)

**What it is**  
Sensitive files (backups, configs) are stored in web-reachable locations without proper access controls, allowing unauthorized download.

**Observed in lab**  
A `.bak` backup and other sales backups were retrievable from `/ftp` or predictable paths without authentication.

**Steps to Reproduce (concise)**  
1. Browse to the known or predictable backup path (e.g., `/ftp/package.json.bak%2500.md`).  
2. Download the file directly via browser or curl.  
3. Inspect contents for secrets, schema, or credentials.

**Impact**  
- Exposure of application internals, credentials, or PII.  
- Facilitates further exploitation (config secrets, DB schema).  
- Significant breach of confidentiality and potential regulatory violations.

**Mitigations**  
- Move backups off web roots and restrict access to internal networks or authenticated admin interfaces.  
- Use non-public storage with strict ACLs (S3-style or internal file shares).  
- Rotate secrets and avoid embedding credentials in files; encrypt backups at rest.

---

### D Misplaced Signature File (Exposed Internal Configuration)

**What it is**  
Internal configuration files (YAML, JSON, keys) are exposed via endpoints or misconfigured directories, revealing sensitive settings and credentials.

**Observed in lab**  
A signature/configuration YAML intended for internal use was accessible via a direct URL or misconfigured static file route.

**Steps to Reproduce (concise)**  
1. Request the known internal filename or enumerated path.  
2. Access the file via HTTP and review contents.  
3. Use discovered information to map system components or craft targeted payloads.

**Impact**  
- Leak of internal API keys, signing secrets, or service endpoints.  
- Enables targeted attacks, forgery, or tampering with application logic.  
- Speeds attacker reconnaissance and exploitation.

**Mitigations**  
- Remove sensitive files from web-accessible directories.  
- Enforce allow-listing for file-serving endpoints and authentication for internal resources.  
- Scan codebase for accidental file exposures and incorporate file-exposure checks in CI.

---

### E Deprecated Interface (Legacy Endpoint Abuse)

**What it is**  
Legacy or deprecated endpoints remain reachable and accept inputs not validated by newer logic, allowing bypasses or unexpected behavior.

**Observed in lab**  
An old XML-based interface accepted modified XML uploads that circumvented modern validation and triggered back-end processing in unsafe ways.

**Steps to Reproduce (concise)**  
1. Identify legacy endpoints via discovery (robots, sitemap, source comments).  
2. Craft a modified XML payload to exploit weak parsing/validation.  
3. POST the payload and observe privileged actions or data leakage.

**Impact**  
- Provides an alternate attack surface not covered by current security controls.  
- May allow injection, logic manipulation, or data exfiltration.  
- Evades security checks implemented only for current APIs.

**Mitigations**  
- Remove or disable deprecated endpoints; maintain an explicit deprecation and removal policy.  
- Apply the same validation, authorization, and logging to legacy interfaces as to current ones.  
- Harden parsers (XML external entity protections, input size limits) and sanitize inputs consistently.

---

## Detection and Logging Recommendations

- Monitor access to administrative, backup, and internal-file paths; alert on anonymous or unusual downloads.  
- Log parameter values for create/update/delete operations and flag when client-supplied identifiers differ from session identity.  
- Detect requests to legacy endpoints and maintain a list of deprecated routes for heightened monitoring.  
- Retain audit trails for file access and content modifications for forensic reconstruction.

---

## Hardening Checklist

- Enforce server-side authorization on every request; never rely on client-provided identity or role parameters.  
- Remove sensitive files and backups from public web roots; apply strict ACLs and encryption.  
- Disable or remove deprecated interfaces and apply modern validation to any legacy endpoints that must remain.  
- Implement predictable ID protections (use non-guessable IDs or check ownership before returning objects).  
- Add anomaly detection for impersonation-like patterns and require re-authentication for high-risk actions.

---
```
